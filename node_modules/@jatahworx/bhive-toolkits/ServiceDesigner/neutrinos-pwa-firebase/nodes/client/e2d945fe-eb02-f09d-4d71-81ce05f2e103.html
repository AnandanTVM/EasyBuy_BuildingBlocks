<script
	type="text/x-red"
	data-template-name="e2d945fe-eb02-f09d-4d71-81ce05f2e103"
></script>
<script type="text/javascript">
	registerNode({
		serviceType: 'client',

		nodeType: 'e2d945fe-eb02-f09d-4d71-81ce05f2e103',

		nodeDef: {
			color: '#677BFC',

			category: 'PWA Firebase',

			docsLink: 'fcm-subscribe',

			defaults: {
				name: { value: '' },
			},
			inputs: 1,
			outputs: 1,

			paletteLabel: 'FCM Subscribe',

			icon:
				'neutrinos-pwa-firebase/e2d945fe-eb02-f09d-4d71-81ce05f2e103.svg',

			label: function () {
				return this.name || 'FCM Subscribe';
			},
			labelStyle: function () {
				return this.name ? 'node_label_italic' : '';
			},
			initdefaults: function (n, S) {
				function handleDependencies(controls, value) {
					if (controls instanceof Array) {
						for (let i = 0; i < controls.length; i++) {
							if (controls[i].action === 'required') {
								if (
									(controls[i].equal &&
										controls[i].equal.to_values.includes(
											value
										)) ||
									(controls[i].notEqual &&
										!controls[
											i
										].notEqual.to_values.includes(value))
								) {
									$('#' + controls[i].id)[controls[i].type](
										'required'
									);
									n._def.defaults[
										controls[i].property
									].required = true;
								} else {
									$('#' + controls[i].id)[controls[i].type](
										'resetRequired'
									);
									n._def.defaults[
										controls[i].property
									].required = false;
								}
							} else if (controls[i].action === 'hidden') {
								if (
									(controls[i].equal &&
										controls[i].equal.to_values.includes(
											value
										)) ||
									(controls[i].notEqual &&
										!controls[
											i
										].notEqual.to_values.includes(value))
								) {
									$('#' + controls[i].id)[controls[i].type](
										'hide'
									);
									$('#' + controls[i].id)
										.closest('.editor-form-row')
										.hide();
									S.defaults.excludeFromValidation(
										n,
										controls[i].property
									);
								} else {
									$('#' + controls[i].id)
										.closest('.editor-form-row')
										.show();
									$('#' + controls[i].id)[controls[i].type](
										'show'
									);
									S.defaults.includeForValidation(
										n,
										controls[i].property
									);
								}
								S.defaults.validateForm(true);
							}
						}
					}
				}
				return Object.assign(this, {
					serverPublicKey: {
						attrDef: {
							options: {
								types: [
									{
										value: 'bh',
										label: 'bh.',
										validate: S.validators.typedInput(
											'bh',
											false
										),
									},
									{ value: 'str', label: 'string' },
									{
										value: 'bh.input',
										label: 'bh.input.',
										validate: S.validators.typedInput(
											'bh.input',
											false
										),
									},
									{
										value: 'bh.local',
										label: 'bh.local.',
										validate: S.validators.typedInput(
											'bh.local',
											false
										),
									},
								],
								required: true,
							},
							label: 'Server Public Key',
							attrType: 'TYPED_INPUT',
						},
						value: null,
						required: true,
					},
					resultMapping: {
						attrDef: {
							options: {
								types: [
									{
										value: 'bh',
										label: 'bh.',
										validate: S.validators.typedInput(
											'bh',
											false
										),
									},
									{
										value: 'bh.input',
										label: 'bh.input.',
										validate: S.validators.typedInput(
											'bh.input',
											false
										),
									},
									{
										value: 'bh.local',
										label: 'bh.local.',
										validate: S.validators.typedInput(
											'bh.local',
											false
										),
									},
								],
								required: true,
							},
							label: 'Result Mapping',
							attrType: 'TYPED_INPUT',
						},
						value: null,
						required: true,
					},
				});
			},
		},
	});
</script>
