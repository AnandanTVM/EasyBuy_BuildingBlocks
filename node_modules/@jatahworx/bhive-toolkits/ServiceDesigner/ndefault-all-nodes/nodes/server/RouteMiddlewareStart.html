<script type="text/x-red" data-template-name="RouteMiddlewareStart">
    <input type="text" id="node-input-name" placeholder="[n-sd]common.label.name" required>
</script>
<script type="text/javascript">
    registerNode({
        nodeType: 'RouteMiddlewareStart',
        serviceType: 'server',
        nodeDef: {
            color: "#13886d",
            category: 'Middleware',
            defaults: {
                name: {
                    value: "", validate: function (v, SD) {
                        const node = this;
                        if (SD.validators.patterns.validbh.test(v)) {
                            let { nodePropsArr: namesArr } = SD.nodes.workspaceNodes(node.type, node.id, 'name', node.z);
                            return !namesArr.includes(v);
                        }
                        return false;
                    }
                },
                inputs: { value: 0 },
                outputs: { value: 1 },
            },
            inputs: 0,
            outputs: 1,
            icon: "ndefault-all-nodes/route-middleware-start-node.svg",
			invisible: true,
			isClassFunction: false,
            oneditprepare: function (SD) {
                const node = this;
                const okay = $('#node-dialog-ok');
                $('#node-input-name').inputField({
                    validator: function (v) {
                        let valid = true;
                        let msg = '';
                        if (!SD.validators.patterns.validbh.test(v)) {
                            valid = false;
                            msg = 'Name should start with an alphabet/underscore and can contain alphanumeric chars';
                        } else if (SD.nodes.workspaceNodes(node.type, node.id, 'name', node.z).nodePropsArr.includes(v)) {
                            valid = false;
                            msg = 'Middlewarestart node with the same name exists in this workspace'
                        } else {
                            valid = true;
                        }
                        return {
                            valid: valid,
                            errorMessage: msg,
                        }
                    },
                    validateOnCreate: true,
                    disableDoneIfInvalid: true,
                    enableDoneIfValid: true
                });
            },
            label: function () {
                return this.name || 'Route Middleware Start'
            },
            docsLink: 'middleware-start-node'
        }
    });
</script>