// TODO: @sankarshanaj - set "docsLink" property
<script type="text/x-red" data-template-name="tls-config">

    <!-- Name-->
    <div class="editor-form-row">
        <input type="text" id="node-input-name">
    </div>
    <!-- Server name-->
    <div class="editor-form-row">
        <input type="text" id="node-input-servername">
    </div>
    <!-- verify server certificate -->
        <input type="checkbox" id="node-input-verifyservercert">
        <!-- <label for="node-input-verifyservercert" class="props-title" style="width: auto" data-i18n="tls.label.verify-server-cert"></label>
    </div> -->

    <!-- Certificate -->
    <div class="editor-form-row">
        <div style="display:flex">
            <input type="text" id="node-input-certificatename" readonly>
            <button class="map-button-wrp">
                <image id="node-config-uploadCer" class="map-button" src="assets/serviceDesigner/upload.svg" title="Click to upload the file" style="width:16px"></image>
            </button>
            <button class="map-button-wrp">
                <image id="node-config-certificatename-clear" class="map-button" title="Map" src="assets/clear.svg"></image>
            </button>
            <input type="text" id="node-input-certificateFilePath" hidden>
            <input type="file" id="node-input-select-file" hidden>
        </div>
    </div>

    <!-- Private key -->
    <div class="editor-form-row">
        <div style="display:flex">
            <input type="text" id="node-input-privateKey" readonly>
            <button class="map-button-wrp">
                <image id="node-config-uploadPrivateKey" class="map-button" src="assets/serviceDesigner/upload.svg" title="Click to upload the file" style="width:16px"></image>
            </button>
            <button class="map-button-wrp">
                <image id="node-config-privateKey-clear" class="map-button" title="Map" src="assets/clear.svg"></image>
            </button>
            <input type="text" id="node-input-privateKeyFilePath" hidden>
            <input type="file" id="node-input-select-privateKey-file" hidden>
        </div>
    </div>

    <!-- passphrase -->
    <div class="editor-form-row">
        <input type="password" id="node-input-passphrase">
    </div>
    <!-- Ca Certificate -->
    <div class="editor-form-row">
        <div style="display:flex">
            <input type="text" id="node-input-caCertificatename" readonly>
            <button class="map-button-wrp">
                <image id="node-config-uploadCACer" class="caCertificatename map-button"  src="assets/serviceDesigner/upload.svg" title="Click to upload the file" style="width:16px"></image>
            </button>
            <button class="map-button-wrp">
                <image id="node-config-caCertificatename-clear" class="caCertificatename map-button" title="Map" src="assets/clear.svg"></image>
            </button>
            <input type="text" id="node-input-cacertificateFilePath" hidden>
            <input type="file" id="node-input-select-caCertificate-file" hidden>
        </div>
    </div>
        


</script>

<script type="text/javascript">

    registerNode({
        nodeType: 'tls-config',
        serviceType: 'server',
        nodeDef: {
            category: 'config',
            color: '#009978',
            defaults: {
                name: { value: "" },
                servername: { value: "" },
                certificatename: { value: "" },
                certificateFilePath: { value: "" },
                privateKey: { value: "" },
                privateKeyFilePath: { value: "" },
                caCertificatename: { value: "" },
                cacertificateFilePath: { value: "" },
                passphrase: { value: "" },
                verifyservercert: { value: true },
                users: {}
            },
            inputs: 1,
            outputs: 1,
            icon: "",
            paletteLabel: 'TLS',
            label: function () {
                return this.name || "tls-config";
            },
            labelStyle: function () {
                return this.name ? "node_label_italic" : "";
            },
            oneditprepare: function (SRD) {
                const node = this
                /* Creates the input field of the name*/
                let nodeName = $(`#node-input-name`).inputField({
                    placeholder: SRD._('common.label.name')
                });

                /* Creates the server input field of the name*/
                let serverName = $(`#node-input-servername`).inputField({
                    placeholder: SRD._('tls.label.servername')
                });

                $("#node-input-verifyservercert").toggleButton({
                    label: SRD._(`tls.label.verifyservercert`),
                    cssObject: {
                        "padding-bottom": "0.8em",
                        "padding-top": "0.3em"
                    },
                    containerId: 'container-verifyservercert'
                });
                $("#container-verifyservercert").css({position: 'relative', left: "3em"})

                // })
                /* Creates the server input field of the name*/
                let passphrase = $(`#node-input-passphrase`).inputField({
                    placeholder: SRD._('tls.label.passphrase')
                });

                // node-config-certificate-name
                /* Certificate */
                let certificateName = $(`#node-input-certificatename`).inputField({
                    props: {
                        "readonly": true
                    },
                    value: node.certificatename || 'Click to upload the file',
                    placeholder: SRD._('tls.label.certificate')
                });

                $("#node-config-uploadCer").on('click', () => {
                    $('#node-input-select-file').trigger('click');
                })

                /* Private key */
                let privateKeyInput = $(`#node-input-privateKey`).inputField({
                    props: {
                        "readonly": true
                    },
                    value: node.privateKey || 'Click to upload the file',
                    placeholder: SRD._('tls.label.key')
                });

                $('#node-config-uploadPrivateKey').on('click', () => {
                    $('#node-input-select-privateKey-file').trigger('click');
                })

                /* ca certificate */
                let caCertificate = $(`#node-input-caCertificatename`).inputField({
                    props: {
                        "readonly": true
                    },
                    value: node.caCertificatename || 'Click to upload the file',
                    placeholder: SRD._('tls.label.ca')
                });

                $("#node-config-uploadCACer").on('click', () => {
                    $('#node-input-select-caCertificate-file').trigger('click');
                })


                function updateFilePath(fileNameVar, filePathVar, fileObj) {
                    if (fileObj && fileObj.length) {
                        $(`#node-input-${fileNameVar}`).val(fileObj[0].name);
                        $(`#node-input-${filePathVar}`).val(fileObj[0].path);
                    }
                }

                $('#node-input-select-file').change(function () {
                    updateFilePath('certificatename', 'certificateFilePath', this.files)
                })

                $('#node-input-select-privateKey-file').change(function () {
                    updateFilePath('privateKey', 'privateKeyFilePath', this.files)
                })
//node-input-privateKey
                $('#node-input-select-caCertificate-file').change(function () {
                    updateFilePath('caCertificatename', 'cacertificateFilePath', this.files)
                })

                function clearFilePaths(fileNameVar, filePathVar) {
                    $(`#node-input-${fileNameVar}`).val("Click to upload the file");
                    $(`#node-input-${filePathVar}`).val("");
                }

                $('#node-config-certificatename-clear').on('click', () => {
                    clearFilePaths('certificatename', 'certificateFilePath')
                })

                $('#node-config-privateKey-clear').on('click', () => {
                    clearFilePaths('privateKey', 'privateKeyFilePath')
                })

                $('#node-config-caCertificatename-clear').on('click', () => {
                    clearFilePaths('caCertificatename', 'cacertificateFilePath')
                })

            },
            oneditsave: function () {

            }
        }
    })

</script>