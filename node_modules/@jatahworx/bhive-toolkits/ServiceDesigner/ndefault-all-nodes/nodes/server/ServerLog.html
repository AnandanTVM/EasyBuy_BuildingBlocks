<script type="text/x-red" data-template-name="ServerLog">
<div class="editor-form-row">
        <label for="node-input-logLevel"><span data-i18n="log.label.log-level"></span></label>
        <select id="node-input-logLevel" style="width: 100%;"></select>
    </div>

    <div class="editor-form-row">
        <label for="node-input-typed-logObject">Log</label>
        <input id="node-input-typed-logObject" type="text" style="width: 100% !important;"/>
    </div>
</script>

<script>
    registerNode({
        nodeType: 'ServerLog',
        serviceType: 'server',
        nodeDef: {
            category: 'General',
            color: "#AB0E86",
            paletteLabel: 'Log',
            defaults: {
                name: { value: "" },
                outputs: { value: 0 },
                logObject: { value: 'bh' },
                logLevel: { value: 'info' },
            },
            inputs: 1,
            outputs: 0,
            icon: "ndefault-all-nodes/log-node.svg",
            label: function () {
                return this.name || 'Log';
            },
            oneditinit: function (SRD) {
                let node = this;
                $('#node-input-name').inputField();

                let logObjvalidateForm = function () {
                    if (!node.logLevel || !$('#node-input-typed-logObject').typedInput('validate')) {
                        if(!$('#node-dialog-ok').hasClass('disabled'))
                            $('#node-dialog-ok').addClass('disabled');
                    }
                    else {
                        $('#node-dialog-ok').removeClass('disabled');
                    }
                }

                let logLevel = $('#node-input-logLevel').selectField({
                    optionsData: [
                        { value: 'info', displayValue: 'info' },
                        { value: 'error', displayValue: 'error' },
                        { value: 'warn', displayValue: 'warn' },
                        { value: 'verbose', displayValue: 'verbose' },
                        { value: 'debug', displayValue: 'debug' },
                        { value: 'silly', displayValue: 'silly' },
                    ],
                    value: node.logLevel
                });

                let logVarObjElm = $('#node-input-typed-logObject').typedInput({
					noformvalidation: false,
                    types: [
                        { value: 'bh', label: 'bh.', validate: SRD.validators.typedInput('bh') },
                        { value: 'bh.input', label: 'bh.input.', validate: SRD.validators.typedInput('bh.input') },
                        { value: 'bh.local', label: 'bh.local.', validate: SRD.validators.typedInput('bh.local') },
                        { value: 'str', label: 'string', validate: SRD.validators.patterns.noblank },
                        { value: 'literal', label: 'as is', validate: SRD.validators.patterns.noblank }
                    ],
                    onvalchanged: logObjvalidateForm,
                    change: logObjvalidateForm
                });
            },
            docsLink: 'log-node'
        }
    })
</script>